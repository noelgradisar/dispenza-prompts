name: Evening Reflection Form

on:
  schedule:
    - cron: '30 19 * * *'
  workflow_dispatch:

jobs:
  send-form:
    runs-on: ubuntu-latest
    
    steps:
      - name: Send Evening Reflection - Question 1
        env:
          BOT_TOKEN: ${{ secrets.TELEGRAM_BOT_TOKEN }}
          CHAT_ID: ${{ secrets.TELEGRAM_CHAT_ID }}
        run: |
          # Question 1: Presence with family (with inline buttons)
          curl -s -X POST "https://api.telegram.org/bot${BOT_TOKEN}/sendMessage" \
            -H "Content-Type: application/json" \
            -d '{
              "chat_id": "'"${CHAT_ID}"'",
              "text": "üåô *Evening Reflection*\n\n*1. How present were you with Melisa and Noel today?*",
              "parse_mode": "Markdown",
              "reply_markup": {
                "inline_keyboard": [
                  [{"text": "1", "callback_data": "presence_1"}, {"text": "2", "callback_data": "presence_2"}, {"text": "3", "callback_data": "presence_3"}, {"text": "4", "callback_data": "presence_4"}, {"text": "5", "callback_data": "presence_5"}],
                  [{"text": "6", "callback_data": "presence_6"}, {"text": "7", "callback_data": "presence_7"}, {"text": "8", "callback_data": "presence_8"}, {"text": "9", "callback_data": "presence_9"}, {"text": "10", "callback_data": "presence_10"}]
                ]
              }
            }'
          sleep 2

      - name: Send Evening Reflection - Question 2
        env:
          BOT_TOKEN: ${{ secrets.TELEGRAM_BOT_TOKEN }}
          CHAT_ID: ${{ secrets.TELEGRAM_CHAT_ID }}
        run: |
          # Question 2: Emotional state
          curl -s -X POST "https://api.telegram.org/bot${BOT_TOKEN}/sendMessage" \
            -H "Content-Type: application/json" \
            -d '{
              "chat_id": "'"${CHAT_ID}"'",
              "text": "*2. Overall emotional state today?*",
              "parse_mode": "Markdown",
              "reply_markup": {
                "inline_keyboard": [
                  [{"text": "1", "callback_data": "emotion_1"}, {"text": "2", "callback_data": "emotion_2"}, {"text": "3", "callback_data": "emotion_3"}, {"text": "4", "callback_data": "emotion_4"}, {"text": "5", "callback_data": "emotion_5"}],
                  [{"text": "6", "callback_data": "emotion_6"}, {"text": "7", "callback_data": "emotion_7"}, {"text": "8", "callback_data": "emotion_8"}, {"text": "9", "callback_data": "emotion_9"}, {"text": "10", "callback_data": "emotion_10"}]
                ]
              }
            }'
          sleep 2

      - name: Send Evening Reflection - Question 3
        env:
          BOT_TOKEN: ${{ secrets.TELEGRAM_BOT_TOKEN }}
          CHAT_ID: ${{ secrets.TELEGRAM_CHAT_ID }}
        run: |
          # Question 3: Gratitude ease
          curl -s -X POST "https://api.telegram.org/bot${BOT_TOKEN}/sendMessage" \
            -H "Content-Type: application/json" \
            -d '{
              "chat_id": "'"${CHAT_ID}"'",
              "text": "*3. How easily could you feel gratitude today?*",
              "parse_mode": "Markdown",
              "reply_markup": {
                "inline_keyboard": [
                  [{"text": "1 üòì", "callback_data": "gratitude_1"}, {"text": "2", "callback_data": "gratitude_2"}, {"text": "3", "callback_data": "gratitude_3"}, {"text": "4", "callback_data": "gratitude_4"}, {"text": "5", "callback_data": "gratitude_5"}],
                  [{"text": "6", "callback_data": "gratitude_6"}, {"text": "7", "callback_data": "gratitude_7"}, {"text": "8", "callback_data": "gratitude_8"}, {"text": "9", "callback_data": "gratitude_9"}, {"text": "10 ‚ú®", "callback_data": "gratitude_10"}]
                ]
              }
            }'
          sleep 2

      - name: Send Evening Reflection - Question 4a
        env:
          BOT_TOKEN: ${{ secrets.TELEGRAM_BOT_TOKEN }}
          CHAT_ID: ${{ secrets.TELEGRAM_CHAT_ID }}
        run: |
          # Question 4a: How many times meditated
          curl -s -X POST "https://api.telegram.org/bot${BOT_TOKEN}/sendMessage" \
            -H "Content-Type: application/json" \
            -d '{
              "chat_id": "'"${CHAT_ID}"'",
              "text": "*4. How many times did you meditate today?*\n\n(Ideal: 2x per day üßò)",
              "parse_mode": "Markdown",
              "reply_markup": {
                "inline_keyboard": [
                  [{"text": "‚ùå None", "callback_data": "meditate_0x"}, {"text": "1x", "callback_data": "meditate_1x"}, {"text": "‚ú® 2x", "callback_data": "meditate_2x"}, {"text": "3x+", "callback_data": "meditate_3x"}]
                ]
              }
            }'
          sleep 2

      - name: Send Evening Reflection - Question 4b
        env:
          BOT_TOKEN: ${{ secrets.TELEGRAM_BOT_TOKEN }}
          CHAT_ID: ${{ secrets.TELEGRAM_CHAT_ID }}
        run: |
          # Question 4b: Total meditation duration
          curl -s -X POST "https://api.telegram.org/bot${BOT_TOKEN}/sendMessage" \
            -H "Content-Type: application/json" \
            -d '{
              "chat_id": "'"${CHAT_ID}"'",
              "text": "*4b. Total meditation time today?*",
              "parse_mode": "Markdown",
              "reply_markup": {
                "inline_keyboard": [
                  [{"text": "‚â§20 min", "callback_data": "duration_20"}, {"text": "‚â§40 min", "callback_data": "duration_40"}],
                  [{"text": "‚â§1 hour", "callback_data": "duration_60"}, {"text": "1h+ üî•", "callback_data": "duration_60plus"}]
                ]
              }
            }'
          sleep 2

      - name: Send Evening Reflection - Question 5
        env:
          BOT_TOKEN: ${{ secrets.TELEGRAM_BOT_TOKEN }}
          CHAT_ID: ${{ secrets.TELEGRAM_CHAT_ID }}
        run: |
          # Question 5: Text responses
          curl -s -X POST "https://api.telegram.org/bot${BOT_TOKEN}/sendMessage" \
            -H "Content-Type: application/json" \
            -d '{
              "chat_id": "'"${CHAT_ID}"'",
              "text": "*5. Reply with your 3 gratitudes* üôè\n\n(Can be for things that haven'"'"'t happened yet!)\n\nExample:\n- Grateful for my million euros\n- Grateful for Melisa'"'"'s smile\n- Grateful for the house in Naklo",
              "parse_mode": "Markdown"
            }'
          sleep 2

      - name: Send Evening Reflection - Question 6
        env:
          BOT_TOKEN: ${{ secrets.TELEGRAM_BOT_TOKEN }}
          CHAT_ID: ${{ secrets.TELEGRAM_CHAT_ID }}
        run: |
          # Question 6: Which prompt hit hardest
          curl -s -X POST "https://api.telegram.org/bot${BOT_TOKEN}/sendMessage" \
            -H "Content-Type: application/json" \
            -d '{
              "chat_id": "'"${CHAT_ID}"'",
              "text": "*6. Which prompt hit hardest today?*\n\n(optional - reply or skip)",
              "parse_mode": "Markdown",
              "reply_markup": {
                "inline_keyboard": [
                  [{"text": "üí∞ Wealth", "callback_data": "best_wealth"}, {"text": "üíú Family", "callback_data": "best_family"}, {"text": "üè° Home", "callback_data": "best_home"}],
                  [{"text": "üí™ Health", "callback_data": "best_health"}, {"text": "‚òÄÔ∏è Joy", "callback_data": "best_joy"}, {"text": "üôè Gratitude", "callback_data": "best_gratitude"}]
                ]
              }
            }'
          sleep 2

      - name: Send Evening Reflection - Final
        env:
          BOT_TOKEN: ${{ secrets.TELEGRAM_BOT_TOKEN }}
          CHAT_ID: ${{ secrets.TELEGRAM_CHAT_ID }}
        run: |
          # Final: Wins and insights
          curl -s -X POST "https://api.telegram.org/bot${BOT_TOKEN}/sendMessage" \
            -H "Content-Type: application/json" \
            -d '{
              "chat_id": "'"${CHAT_ID}"'",
              "text": "*7. Any wins, insights, or breakthroughs today?*\n\nReply with whatever comes to mind.\n\n_Remember: Even when gratitude feels forced, it rewires your brain._ üß†\n\nSleep well, Klemen. Tomorrow you create again. üíú",
              "parse_mode": "Markdown"
            }'
